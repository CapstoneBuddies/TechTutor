ErrorDocument 404 /pages/error/404.php
ErrorDocument 403 /pages/error/403.php 
ErrorDocument 500 /pages/error/500.php

<IfModule mod_headers.c>
    # Allow CORS for all resources (images, JS, CSS, etc.)
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, POST, OPTIONS"
    Header set Access-Control-Allow-Headers "Origin, Content-Type, X-Auth-Token"
    
    # Allow for image content specifically (images, etc.)
    <FilesMatch "\.(jpg|jpeg|png|gif|bmp|svg|webp)$">
        Header set Access-Control-Allow-Origin "*"
    </FilesMatch>
</IfModule>

RewriteEngine On

# üîπ Remove trailing slashes except for root "/"
RewriteCond %{REQUEST_URI} ^(.+)/$ [NC]
RewriteRule ^(.+)/$ %1 [R=301,L]

# ----------------------------------
# üåê General Page Routing
# ----------------------------------
RewriteRule ^sent$ backends/contact_handler.php [L]
RewriteRule ^(.*)/?home$ backends/route.php [L]
RewriteRule ^login$ pages/login.php [L]
RewriteRule ^register$ pages/signup.php [L]
RewriteRule ^verify$ pages/verify.php [L]
RewriteRule ^forgot$ pages/forgot-password.php [L]
RewriteRule ^terms$ pages/terms.php [L]
RewriteRule ^reset$ pages/reset-password.php [L,QSA]
RewriteRule ^certificate/([0-9a-fA-F]{32})$ pages/certificates.php [L]
RewriteRule ^dashboard/[sta]/profile$ pages/profile.php [L]
RewriteRule ^dashboard/[sta]/settings$ pages/settings.php [L]
RewriteRule ^dashboard/[sta]/transactions$ pages/transactions.php [L]
RewriteRule ^dashboard/[sta]/notifications$ pages/notifications.php [L]

# ----------------------------------
# üîπ Authentication and User Actions
# ----------------------------------
RewriteRule ^user-login$ backends/route.php [L]
RewriteRule ^user-register$ backends/route.php [L]
RewriteRule ^verify_code$ backends/route.php [L]
RewriteRule ^forgot-password$ backends/route.php [L]
RewriteRule ^resend-verification-code$ backends/route.php [L]
RewriteRule ^(.*)/?user-logout$ backends/route.php [L]
RewriteRule ^(.*)/?user-profile-update$ backends/route.php [L,QSA]
RewriteRule ^(.*)/?user-deactivate$ backends/route.php [L]
RewriteRule ^(.*)/?user-change-password$ backends/route.php [L]

# ----------------------------------
# üí∞ Payment Routes
# ----------------------------------
RewriteRule ^payment$ pages/payment.php [L]
RewriteRule ^payment-success$ pages/payment-success.php [L]
RewriteRule ^payment-failed$ pages/payment-failed.php [L]
RewriteRule ^create-payment$ backends/route.php [L]
RewriteRule ^process-card-payment$ backends/route.php [L]

# ----------------------------------
# üîî Notifications & Transactions
# ----------------------------------
#RewriteRule ^$  [L]
RewriteRule ^get-transactions$ backends/route.php [L]
RewriteRule ^get-transaction-details$ backends/route.php [L]
RewriteRule ^export-transactions$ backends/route.php [L]

# ----------------------------------
# üè† Dashboard Routing by Role
# ----------------------------------
RewriteRule ^dashboard$ backends/role_redirect.php [L]
RewriteRule ^dashboard/s$ backends/role_redirect.php [L]
RewriteRule ^dashboard/t$ backends/role_redirect.php [L]
RewriteRule ^dashboard/a$ backends/role_redirect.php [L]

# ----------------------------------
# üë®‚Äçüéì TechKids (Students) Routes
# ----------------------------------
RewriteRule ^dashboard/s/class$ pages/techkid/class.php [L]
RewriteRule ^dashboard/s/class/details$ pages/techkid/class-details.php [L,QSA]
RewriteRule ^dashboard/s/schedule$ pages/techkid/schedule.php [L]
RewriteRule ^dashboard/s/files$ pages/techkid/files.php [L,QSA]
RewriteRule ^dashboard/s/certificates$ pages/techkid/certificate.php [L]
RewriteRule ^dashboard/s/enrollments$ pages/techkid/enrollments.php [L]
RewriteRule ^dashboard/s/enrollments/class$ pages/techkid/enroll-class.php [L,QSA]
RewriteRule ^dashboard/s/class/meeting$ pages/techkid/meeting.php [L,QSA]
RewriteRule ^dashboard/s/class/feedbacks$ pages/techkid/class-feedback.php [L,QSA]
RewriteRule ^dashboard/s/class/files$ pages/techkid/class-files.php [L,QSA]
RewriteRule ^dashboard/s/class/recordings$ pages/techkid/class-recordings.php [L,QSA]

# ----------------------------------
# üë®‚Äçüè´ TechGuru (Tutors) Routes
# ----------------------------------
RewriteRule ^dashboard/t/class$ pages/techguru/classes.php [L]
RewriteRule ^dashboard/t/certificates$ pages/techguru/certificates.php [L]
RewriteRule ^dashboard/t/subjects$ pages/techguru/subjects.php [L]
RewriteRule ^dashboard/t/subjects/class$ pages/techguru/subject-details.php [L,QSA]
RewriteRule ^dashboard/t/subjects/class/create$ pages/techguru/create-class.php [L,QSA]
RewriteRule ^dashboard/t/class/details$ pages/techguru/class-details.php [L,QSA]
RewriteRule ^dashboard/t/class/edit$ pages/techguru/class-edit.php [L,QSA]
RewriteRule ^dashboard/t/class/details/schedules$ pages/techguru/manage-schedule.php [L,QSA]
RewriteRule ^dashboard/t/class/details/files$ pages/techguru/class-files.php [L,QSA]
RewriteRule ^dashboard/t/class/details/analytics$ pages/techguru/analytics.php [L,QSA]
RewriteRule ^dashboard/t/class/details/recordings$ pages/techguru/recordings.php [L,QSA]
RewriteRule ^dashboard/t/class/details/feedbacks$ pages/techguru/feedbacks.php [L]

#
RewriteRule ^dashboard/t/class/students$ pages/techguru/students.php [L]
RewriteRule ^dashboard/t/class/schedules$ pages/techguru/schedules.php [L]
RewriteRule ^dashboard/t/class/feedbacks$ pages/techguru/feedbacks.php [L]

# ----------------------------------
# üîß Admin Routes
# ----------------------------------
RewriteRule ^a/delete-user$ backends/route.php [L]
RewriteRule ^a/restrict-user$ backends/route.php [L]
RewriteRule ^a/activate-user$ backends/route.php [L]
RewriteRule ^update-role$ backends/admin/update_user_role.php [L]
RewriteRule ^dashboard/a/users$ pages/admin/view-users.php [L]
RewriteRule ^dashboard/a/users/details$ pages/admin/user-details.php [L,QSA]
RewriteRule ^dashboard/a/courses$ pages/admin/view-course.php [L]
RewriteRule ^dashboard/a/classes$ pages/admin/view-class.php [L]
RewriteRule ^dashboard/a/classes/details$ pages/admin/class-details.php [L,QSA]

# ----------------------------------
# üõ† AJAX Actions
# ----------------------------------
RewriteRule ^logs$ backends/logs.php [L]
RewriteRule ^get-users$ backends/admin/get_users.php [L]
RewriteRule ^toggle-user-status$ backends/admin/toggle_user_status.php [L]
RewriteRule ^delete-user$ backends/admin/delete_user.php [L]
RewriteRule ^send-password-reset$ backends/admin/send_password_reset.php [L]
RewriteRule ^get-user-emails$ backends/admin/get_user_emails.php [L]
#Admin 
RewriteRule ^add-course$ backends/admin/course_handler.php [L]
RewriteRule ^edit-course$ backends/admin/course_handler.php [L]
RewriteRule ^delete-course$ backends/admin/course_handler.php [L]
RewriteRule ^add-subject$ backends/admin/course_handler.php [L]
RewriteRule ^edit-subject$ backends/admin/course_handler.php [L]
RewriteRule ^delete-subject$ backends/admin/course_handler.php [L]
RewriteRule ^toggle-subject$ backends/admin/course_handler.php [L,QSA]
RewriteRule ^update-subject-cover$ backends/admin/course_handler.php [L]

# ----------------------------------
# üåç API Endpoints
# ----------------------------------
RewriteRule ^api/toggle-class-status$ backends/api/toggle-class-status.php [L]
RewriteRule ^api/enroll-class$ backends/api/enroll-class.php [L]

# Materials API endpoints
RewriteRule ^api/materials$ backends/handler/unified_file_handler.php [QSA,L]

# Schedule API endpoints
RewriteRule ^api/schedule/([0-9]+)$ backends/api/schedules.php?id=$1 [QSA,L]
RewriteRule ^api/schedules$ backends/api/schedules.php [QSA,L]
RewriteRule ^schedule-delete$ backends/api/schedule_delete.php [L]

RewriteRule ^mark-notification-read$ backends/api/mark-notification-read.php [L]
RewriteRule ^delete-notification$ backends/api/delete-notif.php [L]
RewriteRule ^mark-all-notifications-read$ backends/api/mark-all-notif-read.php [L]
RewriteRule ^check-notifications$ backends/api/check-notifications.php [L]
RewriteRule ^fix-permissions$ backends/api/fix-permissions.php [L]
RewriteRule ^submit-feedback$ backends/api/submit-feedback.php [L]

# Class feedback page
RewriteRule ^techkid/class-feedback$ pages/techkid/class-feedback.php [QSA,L]

#TechGuru
RewriteRule ^api/search-students$ backends/api/search-students.php [L]
RewriteRule ^api/invite-students$ backends/api/invite-students.php [L]
RewriteRule ^api/send-message$ backends/api/send-message.php [L]

#BBB
RewriteRule ^api/meeting$ backends/handler/meeting_handlers.php [L,QSA]
